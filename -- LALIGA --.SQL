SET SERVEROUTPUT ON;
-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------
-- Mi intento
-- DECLARE

--     TYPE EQUIPO IS RECORD(
--         NOM_EQUIPO EQUIPOS.NOMBRE%TYPE,
--         PTOS NUMBER
--     );

--     TYPE TABLA IS TABLE OF REG INDEX BY BINARY_INTEGER;
--     TB TABLA;
--     I BINARY_INTEGER;

-- BEGIN

--     FOR I IN (SELECT * FROM EQUIPOS) LOOP

--         FOR J IN (SELECT * FROM JORNADAS) LOOP



--         END LOOP;
--     END LOOP;

-- END;

-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------
-- Profe
DROP TABLE CLASIFICACION;
CREATE TABLE CLASIFICACION(
    IDEQUIPO INTEGER PRIMARY KEY,
    NOMBRE VARCHAR2(40),
    PTOS INTEGER
);

DECLARE
    TYPE REG IS RECORD (
        NOM_EQUIPO EQUIPOS.NOMBRE%TYPE,
        PTOS NUMBER
    );

    TYPE TB IS TABLE OF REG INDEX BY BINARY_INTEGER;
    CLASIFICACION TB;
    I BINARY_INTEGER;

BEGIN

    FOR I IN (SELECT * FROM EQUIPOS) LOOP
        CLASIFICACION(I.IDEQUIPO).NOM_EQUIPO := I.NOMBRE;
        CLASIFICACION(I.IDEQUIPO).PTOS := 0;
    END LOOP;

    FOR I IN (SELECT * FROM PARTIDOS) LOOP
        IF (I.GOL_LOCAL > I.GOL_VISITANTE) THEN
            CLASIFICACION(I.IDLOCAL).PTOS := CLASIFICACION(I.IDLOCAL).PTOS + 3;
        ELSIF (I.GOL_LOCAL < I.GOL_VISITANTE) THEN
            CLASIFICACION(I.IDVISITANTE).PTOS := CLASIFICACION(I.IDVISITANTE).PTOS + 3;
        ELSE
            CLASIFICACION(I.IDLOCAL).PTOS := CLASIFICACION(I.IDLOCAL).PTOS + 1;
            CLASIFICACION(I.IDVISITANTE).PTOS := CLASIFICACION(I.IDVISITANTE).PTOS + 1;
        END IF;
    END LOOP;

    I := CLASIFICACION.FIRST;
    WHILE (I <= CLASIFICACION.LAST) LOOP
        INSERT INTO CLASIFICACION VALUES(I, CLASIFICACION(I).NOM_EQUIPO, CLASIFICACION(I).PTOS);
        I := CLASIFICACION.NEXT(I);
    END LOOP;
END;
/

SELECT * FROM CLASIFICACION;

-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------
-- LA LIGA
DROP TABLE IF EXISTS CLASI;
CREATE TABLE CLASIFICACION(
    NOMBRE VARCHAR2(40) PRIMARY KEY,
    PG NUMBER,
    PE NUMBER,
    PP NUMBER,
    PJ NUMBER,
    PTOS NUMBER
);

DECLARE
    TYPE REG IS RECORD (
        PG NUMBER,
        PE NUMBER,
        PP NUMBER,
        PJ NUMBER,
        PTOS NUMBER
    );

    TYPE TB IS TABLE OF REG INDEX BY VARCHAR2(40);
    CLASIFICACION TB;
    I VARCHAR2(40);

BEGIN

    FOR I IN (SELECT * FROM EQUIPOS) LOOP
        CLASIFICACION(I.NOMBRE).PTOS := 0;
        CLASIFICACION(I.NOMBRE).PG := 0;
        CLASIFICACION(I.NOMBRE).PE := 0;
        CLASIFICACION(I.NOMBRE).PP := 0;
        CLASIFICACION(I.NOMBRE).PJ := 0;
    END LOOP;

    FOR I IN (SELECT B.NOMBRE NOM_LOCAL, C.NOMBRE NOM_VISI, GOL_LOCAL, GOL_VISITANTE
                FROM PARTIDOS A, EQUIPOS B, EQUIPOS C
                WHERE B.IDEQUIPO = A.IDLOCAL AND C.IDEQUIPO = A.IDVISITANTE) LOOP

        IF (I.GOL_LOCAL > I.GOL_VISITANTE) THEN
            CLASIFICACION(I.NOM_LOCAL).PTOS := CLASIFICACION(I.NOM_LOCAL).PTOS + 3;
            CLASIFICACION(I.NOM_LOCAL).PG := CLASIFICACION(I.NOM_LOCAL).PG +1;
            CLASIFICACION(I.NOM_LOCAL).PJ := CLASIFICACION(I.NOM_LOCAL).PJ +1;
            CLASIFICACION(I.NOM_VISI).PJ := CLASIFICACION(I.NOM_VISI).PJ +1;
            CLASIFICACION(I.NOM_VISI).PP := CLASIFICACION(I.NOM_VISI).PP +1;
        ELSIF (I.GOL_LOCAL < I.GOL_VISITANTE) THEN
            CLASIFICACION(I.NOM_VISI).PTOS := CLASIFICACION(I.NOM_VISI).PTOS + 3;
            CLASIFICACION(I.NOM_VISI).PG := CLASIFICACION(I.NOM_VISI).PG +1;
            CLASIFICACION(I.NOM_VISI).PJ := CLASIFICACION(I.NOM_VISI).PJ +1;
            CLASIFICACION(I.NOM_LOCAL).PJ := CLASIFICACION(I.NOM_LOCAL).PJ +1;
            CLASIFICACION(I.NOM_LOCAL).PP := CLASIFICACION(I.NOM_LOCAL).PP +1;
        ELSE
            CLASIFICACION(I.NOM_LOCAL).PTOS := CLASIFICACION(I.NOM_LOCAL).PTOS + 1;
            CLASIFICACION(I.NOM_VISI).PTOS := CLASIFICACION(I.NOM_VISI).PTOS + 1;
            CLASIFICACION(I.NOM_LOCAL).PE := CLASIFICACION(I.NOM_LOCAL).PE +1;
            CLASIFICACION(I.NOM_VISI).PE := CLASIFICACION(I.NOM_VISI).PE +1;
        END IF;
    END LOOP;

    I := CLASIFICACION.FIRST;
    WHILE (I <= CLASIFICACION.LAST) LOOP
    INSERT INTO CLASIFICACION VALUES(I, CLASIFICACION(I).PG, CLASIFICACION(I).PE, CLASIFICACION(I).PP, CLASIFICACION(I).PJ, CLASIFICACION(I).PTOS );
    I := CLASIFICACION.NEXT(I);

    END LOOP;
END;
/

SELECT * FROM CLASIFICACION;

SELECT B.NOMBRE NO_LOCAL, C.NOMBRE NOM_VISI, GOL_LOCAL, GOL_VISITANTE
FROM PARTIDOS A, EQUIPOS B, EQUIPOS C
WHERE B.IDEQUIPO = A.IDLOCAL AND C.IDEQUIPO = A.IDVISITANTE